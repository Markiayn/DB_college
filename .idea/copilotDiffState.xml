<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/controller/UserController.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/controller/UserController.java" />
              <option name="originalContent" value="package ua.markiyan.sonara.controller;&#10;&#10;import jakarta.validation.Valid;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.http.*;&#10;import org.springframework.web.bind.annotation.*;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#10;import ua.markiyan.sonara.service.UserService;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/users&quot;)&#10;@RequiredArgsConstructor&#10;public class UserController {&#10;&#10;    private final UserService service;&#10;&#10;    @PostMapping&#10;    public ResponseEntity&lt;UserResponse&gt; create(@Valid @RequestBody UserRequest req) {&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(service.create(req));&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public UserResponse get(@PathVariable Long id) {&#10;        return service.get(id);&#10;    }&#10;&#10;    @PatchMapping(&quot;/{id}&quot;)&#10;    public UserResponse patch(@PathVariable Long id, @RequestBody ua.markiyan.sonara.dto.request.UserUpdateRequest req) {&#10;        return service.update(id, req);&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; delete(@PathVariable Long id) {&#10;        service.delete(id);&#10;        return ResponseEntity.noContent().build();&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package ua.markiyan.sonara.controller;&#10;&#10;import jakarta.validation.Valid;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.http.*;&#10;import org.springframework.web.bind.annotation.*;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#10;import ua.markiyan.sonara.service.UserService;&#10;&#10;@RestController&#10;@RequestMapping(&quot;/api/users&quot;)&#10;@RequiredArgsConstructor&#10;public class UserController {&#10;&#10;    private final UserService service;&#10;&#10;    @PostMapping&#10;    public ResponseEntity&lt;UserResponse&gt; create(@Valid @RequestBody UserRequest req) {&#10;        return ResponseEntity.status(HttpStatus.CREATED).body(service.create(req));&#10;    }&#10;&#10;    @GetMapping(&quot;/{id}&quot;)&#10;    public UserResponse get(@PathVariable Long id) {&#10;        return service.get(id);&#10;    }&#10;&#10;    @GetMapping&#10;    public org.springframework.data.domain.Page&lt;UserResponse&gt; search(&#10;            @RequestParam(required = false) String q,&#10;            org.springframework.data.domain.Pageable pageable&#10;    ) {&#10;        return service.search(q, pageable);&#10;    }&#10;&#10;    @PatchMapping(&quot;/{id}&quot;)&#10;    public UserResponse patch(@PathVariable Long id, @RequestBody ua.markiyan.sonara.dto.request.UserUpdateRequest req) {&#10;        return service.update(id, req);&#10;    }&#10;&#10;    @DeleteMapping(&quot;/{id}&quot;)&#10;    public ResponseEntity&lt;?&gt; delete(@PathVariable Long id) {&#10;        service.delete(id);&#10;        return ResponseEntity.noContent().build();&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/repository/UserRepository.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/repository/UserRepository.java" />
              <option name="originalContent" value="package ua.markiyan.sonara.repository;&#10;&#10;import java.util.Optional;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#10;import ua.markiyan.sonara.entity.User;&#10;&#10;public interface UserRepository extends JpaRepository&lt;User, Long&gt; {&#10;    Optional&lt;User&gt; findByNameIgnoreCase(String name);&#10;    boolean existsByNameIgnoreCase(String name);&#10;}&#10;" />
              <option name="updatedContent" value="package ua.markiyan.sonara.repository;&#13;&#10;&#13;&#10;import java.util.Optional;&#13;&#10;import org.springframework.data.domain.Page;&#13;&#10;import org.springframework.data.domain.Pageable;&#13;&#10;import org.springframework.data.jpa.repository.JpaRepository;&#13;&#10;import ua.markiyan.sonara.entity.User;&#13;&#10;&#13;&#10;public interface UserRepository extends JpaRepository&lt;User, Long&gt; {&#13;&#10;    Optional&lt;User&gt; findByNameIgnoreCase(String name);&#13;&#10;    boolean existsByNameIgnoreCase(String name);&#13;&#10;&#13;&#10;    Page&lt;User&gt; findByNameContainingIgnoreCaseOrEmailContainingIgnoreCase(String name, String email, Pageable pageable);&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/service/UserService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/service/UserService.java" />
              <option name="originalContent" value="package ua.markiyan.sonara.service;&#10;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#10;import ua.markiyan.sonara.dto.request.UserUpdateRequest;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#10;&#10;public interface UserService {&#10;    UserResponse create(UserRequest request);&#10;    UserResponse get(Long id);&#10;&#10;    UserResponse update(Long id, UserUpdateRequest req);&#10;    void delete(Long id);&#10;}&#10;" />
              <option name="updatedContent" value="package ua.markiyan.sonara.service;&#13;&#10;&#13;&#10;import org.springframework.data.domain.Page;&#13;&#10;import org.springframework.data.domain.Pageable;&#13;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#13;&#10;import ua.markiyan.sonara.dto.request.UserUpdateRequest;&#13;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#13;&#10;&#13;&#10;public interface UserService {&#13;&#10;    UserResponse create(UserRequest request);&#13;&#10;    UserResponse get(Long id);&#13;&#10;&#13;&#10;    UserResponse update(Long id, UserUpdateRequest req);&#13;&#10;    void delete(Long id);&#13;&#10;&#13;&#10;    Page&lt;UserResponse&gt; search(String q, Pageable pageable);&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/service/impl/UserServiceImpl.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/sonara/src/main/java/ua/markiyan/sonara/service/impl/UserServiceImpl.java" />
              <option name="originalContent" value="package ua.markiyan.sonara.service.impl;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#10;import ua.markiyan.sonara.dto.request.UserUpdateRequest;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#10;import ua.markiyan.sonara.entity.User;&#10;import ua.markiyan.sonara.exception.NotFoundException;&#10;import ua.markiyan.sonara.mapper.UserMapper;&#10;import ua.markiyan.sonara.repository.UserRepository;&#10;import ua.markiyan.sonara.service.UserService;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserServiceImpl implements UserService {&#10;&#10;    private final UserRepository repo;&#10;    private final PasswordEncoder encoder;&#10;&#10;    @Override&#10;    @Transactional&#10;    public UserResponse create(UserRequest req) {&#10;        if (repo.existsByNameIgnoreCase(req.name())) {&#10;            throw new IllegalArgumentException(&quot;User with the same name already exists&quot;);&#10;        }&#10;&#10;        // мапимо DTO в ентіті&#10;        User entity = UserMapper.toEntity(req);&#10;&#10;        // тут шифруємо пароль перед збереженням&#10;        entity.setPasswordHash(encoder.encode(req.password()));&#10;&#10;        User saved = repo.save(entity);&#10;        return UserMapper.toResponse(saved);&#10;    }&#10;&#10;    @Override&#10;    @Transactional(readOnly = true)&#10;    public UserResponse get(Long id) {&#10;        User u = repo.findById(id)&#10;                .orElseThrow(() -&gt; new NotFoundException(&quot;User %d not found&quot;.formatted(id)));&#10;        return UserMapper.toResponse(u);&#10;    }&#10;&#10;    @Override&#10;    @Transactional&#10;    public UserResponse update(Long id, UserUpdateRequest req) {&#10;        User u = repo.findById(id)&#10;                .orElseThrow(() -&gt; new NotFoundException(&quot;User %d not found&quot;.formatted(id)));&#10;&#10;        if (req.email() != null &amp;&amp; !req.email().isBlank()) u.setEmail(req.email());&#10;        if (req.name() != null &amp;&amp; !req.name().isBlank()) u.setName(req.name());&#10;        if (req.country() != null) u.setCountry(req.country());&#10;&#10;        User saved = repo.save(u);&#10;        return UserMapper.toResponse(saved);&#10;    }&#10;&#10;    @Override&#10;    @Transactional&#10;    public void delete(Long id) {&#10;        if (!repo.existsById(id)) throw new NotFoundException(&quot;User %d not found&quot;.formatted(id));&#10;        repo.deleteById(id);&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package ua.markiyan.sonara.service.impl;&#10;&#10;import lombok.RequiredArgsConstructor;&#10;import org.springframework.security.crypto.password.PasswordEncoder;&#10;import org.springframework.stereotype.Service;&#10;import org.springframework.transaction.annotation.Transactional;&#10;import ua.markiyan.sonara.dto.request.UserRequest;&#10;import ua.markiyan.sonara.dto.request.UserUpdateRequest;&#10;import ua.markiyan.sonara.dto.response.UserResponse;&#10;import ua.markiyan.sonara.entity.User;&#10;import ua.markiyan.sonara.exception.NotFoundException;&#10;import ua.markiyan.sonara.mapper.UserMapper;&#10;import ua.markiyan.sonara.repository.UserRepository;&#10;import ua.markiyan.sonara.service.UserService;&#10;&#10;@Service&#10;@RequiredArgsConstructor&#10;public class UserServiceImpl implements UserService {&#10;&#10;    private final UserRepository repo;&#10;    private final PasswordEncoder encoder;&#10;&#10;    @Override&#10;    @Transactional&#10;    public UserResponse create(UserRequest req) {&#10;        if (repo.existsByNameIgnoreCase(req.name())) {&#10;            throw new IllegalArgumentException(&quot;User with the same name already exists&quot;);&#10;        }&#10;&#10;        // мапимо DTO в ентіті&#10;        User entity = UserMapper.toEntity(req);&#10;&#10;        // тут шифруємо пароль перед збереженням&#10;        entity.setPasswordHash(encoder.encode(req.password()));&#10;&#10;        User saved = repo.save(entity);&#10;        return UserMapper.toResponse(saved);&#10;    }&#10;&#10;    @Override&#10;    @Transactional(readOnly = true)&#10;    public UserResponse get(Long id) {&#10;        User u = repo.findById(id)&#10;                .orElseThrow(() -&gt; new NotFoundException(&quot;User %d not found&quot;.formatted(id)));&#10;        return UserMapper.toResponse(u);&#10;    }&#10;&#10;    @Override&#10;    @Transactional&#10;    public UserResponse update(Long id, UserUpdateRequest req) {&#10;        User u = repo.findById(id)&#10;                .orElseThrow(() -&gt; new NotFoundException(&quot;User %d not found&quot;.formatted(id)));&#10;&#10;        if (req.email() != null &amp;&amp; !req.email().isBlank()) u.setEmail(req.email());&#10;        if (req.name() != null &amp;&amp; !req.name().isBlank()) u.setName(req.name());&#10;        if (req.country() != null) u.setCountry(req.country());&#10;&#10;        User saved = repo.save(u);&#10;        return UserMapper.toResponse(saved);&#10;    }&#10;&#10;    @Override&#10;    @Transactional(readOnly = true)&#10;    public org.springframework.data.domain.Page&lt;UserResponse&gt; search(String q, org.springframework.data.domain.Pageable pageable) {&#10;        String pattern = (q == null) ? &quot;&quot; : q.trim();&#10;        return repo.findByNameContainingIgnoreCaseOrEmailContainingIgnoreCase(pattern, pattern, pageable)&#10;                .map(UserMapper::toResponse);&#10;    }&#10;&#10;    @Override&#10;    @Transactional&#10;    public void delete(Long id) {&#10;        if (!repo.existsById(id)) throw new NotFoundException(&quot;User %d not found&quot;.formatted(id));&#10;        repo.deleteById(id);&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>